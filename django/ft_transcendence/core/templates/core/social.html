{% load static %}
{% load socialaccount %}
{% include 'core/sidenav.html' %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'core/css/login.css' %}">
    <link rel="stylesheet" href="{% static 'core/css/social.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <!---------- Media Queries ---------->
    <link rel="stylesheet" href="{% static 'core/css/media-queries/social_media-queries-width.css' %}" media="screen and (max-width: 942px)">
    <link rel="stylesheet" href="{% static 'core/css/media-queries/social_media-queries-height.css' %}" media="screen and (max-height: 642px)">
    <title>Profile Page - {{ user.username }}</title>
</head>

<body class="scroll">
    <!---------- Global container for layout management ---------->
    <div class="container">
        <!---------- Background Video ---------->
        <video autoplay muted loop class="video-background">
            <source src="{% static 'core/images/planet-background.mp4' %}" type="video/mp4">
            Your browser does not support the video tag.
        </video>

        <!---------- Social Buttons on top of the page ---------->
        <div class="social-bar">
            <!---------- All Friends Button ---------->
            <div class="social-bar--buttons-container">
                <button type="submit" class="social-bar--buttons" data-info="all_friends" data-img-clicked="{% static 'core/images/friends-logo-dark.png' %}">
                    <img src="{% static 'core/images/friends-logo.png' %}" class="icons-logos">
                    <span>Friends</span>
                </button>
            </div>

            <!---------- Pending Requests Button ---------->
            <div class="social-bar--buttons-container">
                <button type="submit" class="social-bar--buttons" data-info="pending_requests" data-img-clicked="{% static 'core/images/pending-logo-dark.png' %}">
                    <img src="{% static 'core/images/pending-logo.png' %}" class="icons-logos">
                    <span>Pending</span>
                </button>
            </div>

            <!---------- Blocked Users Button ---------->
            <div class="social-bar--buttons-container">
                <button type="submit" class="social-bar--buttons" data-info="blocked_users" data-img-clicked="{% static 'core/images/blocked-logo-dark.png' %}">
                    <img src="{% static 'core/images/blocked-logo.png' %}" class="icons-logos">
                    <span>Blocked</span>
                </button>
            </div>

            <!---------- Search User Field ---------->
            <div class="social-bar--search-user">
                <div class="social-bar--search-field">
                    <form action="/social/" method="post" class="">
                        {% csrf_token %}
                        {{ search_form.as_p }}
                    </form>

                    {% if not user_found %}
                        <p class="error-message">The user <strong>{{ searched_username }}</strong> could not be found.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!---------- Info Container : displays either friends list, pending requests or blocked users - Has to be empty by default to make sure that nothing will be displayed at first ---------->
        <div class="social--info-container" id="infoContainer"></div>

        <!---------- Templates for each button content ---------->
        <!---------- Friends Section ---------->
        <template id="all-friends-template">
            <div class="social--container-animation">
                <div class="social--title">
                    <h3 class="social--title-style">All Friends</h3>
                </div>
                <hr class="social-bar--line">
                <div class='social--display-list'>
                    <ul class='social--all-users-profile'>
                        {% for friend in all_friends %}
                            <li class="social--each-user-profile-container">
                                <div class='container--user-avatar'>
                                    <a href="/profile/{{ friend.username }}">
                                        <img src="{{ friend.userprofile.avatar.url }}" alt="User Avatar" class="user-avatar-img"/>
                                    </a>
                                </div>
                                <div class="social--user-profile-username">
                                    <a href="/profile/{{ friend.username }}"> {{ friend.username }} </a>
                                </div>
                                <div class="social--user-profile-buttons">
                                    <button type="submit" class="social--user-profile-buttons-design buttons-design">
                                        <a href="{% url 'chat:get_room_redirect' friend.id %}">
                                            <img src="{% static 'core/images/chat-logo.png' %}" class="social--buttons-section-logos">
                                        </a>
                                    </button>
                                    <button type="submit" class="social--user-profile-buttons-design buttons-design">
                                        <a href="{% url 'chat:get_room_redirect' friend.id %}">
                                            <img src="{% static 'core/images/game-logo.png' %}" class="social--buttons-section-logos">
                                        </a>
                                    </button>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </template>

        <!---------- Pending Requests Section ---------->
        <template id="pending-requests-template">
            <div class="social--container-animation">
                <div class="social--title">
                    <h3 class="social--title-style">Pending Requests</h3>
                </div>
                <hr class="social-bar--line">
                <div class='social--display-list'>
                    <ul class='social--all-users-profile'>
                        {% for friend_request in all_friend_request %}
                            {% if user.id != friend_request.sender.id %}
                                <li class="social--each-user-profile-container">
                                    <div class='container--user-avatar'>
                                        <img src="{{ friend_request.sender.userprofile.avatar.url }}" alt="User Avatar" class="user-avatar-img"/>
                                    </div>
                                    <div class="social--user-profile-username">
                                        <a href="/profile/{{ friend_request.sender.username }}">{{ friend_request.sender.username }}</a>
                                    </div>
                                    <div class="social--user-profile-buttons">
                                        <button type="submit" class="social--user-profile-buttons-design buttons-design">
                                            <a href="/decline_friend_request/{{ friend_request.id }}">
                                                <img src="{% static 'core/images/decline-logo.png' %}" class="social--buttons-section-logos">
                                            </a>
                                        </button>
                                        <button type="submit" class="social--user-profile-buttons-design">
                                            <a href="/accept_friend_request/{{ friend_request.id }}">
                                                <img src="{% static 'core/images/accept-logo.png' %}" class="social--buttons-section-logos">
                                            </a>
                                        </button>
                                    </div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </template>

            <!---------- Blocked Users Section ---------->
        <template id="blocked-users-template">
            <div class="social--container-animation">
                <div class="social--title">
                    <h3 class="social--title-style">Blocked Users</h3>
                </div>
                <hr class="social-bar--line">
                <div class='social--display-list'>
                    <ul class='social--all-users-profile'>
                        {% for block_user in blocked_users %}
                            <li class="social--each-user-profile-container">
                                <div class='container--user-avatar'>
                                    <img src="{{ block_user.userprofile.avatar.url }}" alt="User Avatar" class="user-avatar-img"/>
                                </div>
                                <div class="social--user-profile-username">
                                    <a>{{ block_user.username }}</a>
                                </div>
                                <div class="social--user-profile-buttons">
                                    <button type="submit" class="social--user-profile-unblock-button-design buttons-design">
                                        <a href="/unblock_user/{{ block_user.id }}" class="social--buttons-section-text">
                                            Unblock
                                        </a>
                                    </button>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </template>
    </div>

    <script>

        // Get all buttons with the "social-bar--buttons" class
        const socialButtons = document.querySelectorAll('.social-bar--buttons');
        
        // Get the Friends button specifically
        const friendsButton = document.querySelector('.social-bar--friends .social-bar--buttons');
    
        // Get the container where the information will be displayed
        const infoContainer = document.getElementById('infoContainer');
    
        // Function to load the corresponding template based on button click
        function loadContent(templateId) {
            const template = document.getElementById(templateId);
            if (template) {
                // Clone template's content and display it in the container
                const content = template.content.cloneNode(true);
                infoContainer.innerHTML = ''; // Clear existing content
                infoContainer.appendChild(content); // Add new content to the container
            }
        }
    
        // Function to handle button clicks and update the content
        function handleButtonClick(event) {
            // Remove 'buttons-active' class from all buttons and reset images
            socialButtons.forEach(button => {
                button.classList.remove('buttons-active');
                const imgElement = button.querySelector('img');
                const originalSrc = button.getAttribute('data-img-original');
                if (imgElement && originalSrc) {
                    imgElement.src = originalSrc;
                }
            });
    
            // Add 'buttons-active' class to clicked button and update image
            const clickedButton = event.currentTarget;
            clickedButton.classList.add('buttons-active');
            const imgElement = clickedButton.querySelector('img');
            const clickedImgSrc = clickedButton.getAttribute('data-img-clicked');
            if (imgElement && clickedImgSrc) {
                imgElement.src = clickedImgSrc;
                imgElement.classList.add('icons-logos');
            }
    
            // Load the corresponding template based on data-info attribute
            const dataType = clickedButton.getAttribute('data-info');
            if (dataType === 'all_friends') {
                loadContent('all-friends-template');
            } else if (dataType === 'pending_requests') {
                loadContent('pending-requests-template');
            } else if (dataType === 'blocked_users') {
                loadContent('blocked-users-template');
            }
        }
    
        // Store original image source for each button and add click listeners
        socialButtons.forEach(button => {
            const imgElement = button.querySelector('img');
            if (imgElement) {
                button.setAttribute('data-img-original', imgElement.src);
            }
            button.addEventListener('click', handleButtonClick);
        });
    
        // Load the Friends section by default on page load and mark the button as active
        window.addEventListener('DOMContentLoaded', () => {
            loadContent('all-friends-template'); // Load Friends content
            friendsButton.classList.add('buttons-active'); // Mark Friends button as active
    
            // Change Friends button image to clicked version
            const imgElement = friendsButton.querySelector('img');
            const clickedImgSrc = friendsButton.getAttribute('data-img-clicked');
            if (imgElement && clickedImgSrc) {
                imgElement.src = clickedImgSrc;
                imgElement.classList.add('icons-logos');
            }
        });
    </script>
    
    
        <!-- <script>
            // Get all buttons with the "social-bar--buttons" class
            const socialButtons = document.querySelectorAll('.social-bar--buttons');

            // Get the container where informations will be displayed
            const infoContainer = document.getElementById('infoContainer');

            // Loop through the buttons and add the same click event listener to each
            socialButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Récupérer les informations stockées dans l'attribut "data-info"
                    const info = button.getAttribute('data-info');
                    socialButtons.forEach(btn => btn.classList.remove('hidden'));
                    socialButtons.forEach(btn => btn.classList.add('social-bar--buttons'));

                    // Afficher les informations dans le conteneur
                    infoContainer.textContent = info;
                });
            });
        </script>

        <div class="search-user">
            <h1>Welcome, {{ user.username }}</h1>
            <form action="/social/" method="post" class="form-box">
                {% csrf_token %}
                {{ search_form.as_p }}
                <input type="submit" value="Search" class="submit-button">
            </form>

            {% if not user_found %}
                <p class="error-message">The user <strong>{{ searched_username }}</strong> could not be found.</p>
            {% endif %}

            <div class="section">
                <h2>Available Friend Requests</h2>
                <ul class="friend-list">
                    {% for friend_request in available_friend_request %}
                        <li>{{ friend_request.username }} <a href="/send_friend_request/{{ friend_request.id }}">Send Friend Request</a></li>
                    {% endfor %}
                </ul>
            </div>

                        <div class="social-bar--remove-friends">
                            <button type="submit" class="social-bar--buttons">
                                Remove
                                <div class="friend-list hidden social-bar--buttons">
                                {% for friend in all_friends %}
                                    <li>Remove <a href="/remove_friend/{{ friend.id }}">{{ friend.username }}</a></li>
                                {% endfor %}
                                </div>
                            </button>
                        </div>
            -->
            <!-- <div class="section">
                <h2>All Users</h2>
                <ul class="friend-list">
                    {% for db_user in all_users %}
                        {% if not db_user.is_superuser and db_user != user %}
                            <li class="block-user">Block <a href="/block_user/{{ db_user.id }}">{{ db_user.username }}</a></li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div> -->
</body>
</html>
